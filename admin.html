<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Qu·∫£n l√Ω nh√¢n s·ª±</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <h1 class="text-2xl font-bold mb-6">Admin - Qu·∫£n l√Ω nh√¢n s·ª±</h1>

  <form id="adminForm" class="bg-white shadow rounded p-6 max-w-2xl space-y-4">
    <div>
      <label class="block text-gray-700">ID (t·ª± sinh, kh√¥ng s·ª≠a)</label>
      <input id="id" type="text" readonly class="w-full border rounded px-3 py-2 bg-gray-100">
    </div>

    <div>
      <label class="block text-gray-700">H·ªç T√™n</label>
      <input id="name" type="text" class="w-full border rounded px-3 py-2">
    </div>

    <div>
      <label class="block text-gray-700">Ng√†y sinh</label>
      <input id="dob" type="date" class="w-full border rounded px-3 py-2">
    </div>

    <div>
      <label class="block text-gray-700">SƒêT</label>
      <input id="phone" type="tel" class="w-full border rounded px-3 py-2">
    </div>

    <div>
      <label class="block text-gray-700">Ng√†y b·∫Øt ƒë·∫ßu c√¥ng vi·ªác</label>
      <input id="start" type="month" class="w-full border rounded px-3 py-2">
    </div>

    <div>
      <label class="block text-gray-700">V·ªã tr√≠</label>
      <input id="position" type="text" class="w-full border rounded px-3 py-2">
    </div>

    <div>
      <label class="block text-gray-700">Ph√≤ng</label>
      <input id="department" type="text" class="w-full border rounded px-3 py-2">
    </div>

    <div>
      <label class="block text-gray-700">Avatar (png/jpg)</label>
      <input id="avatar" type="file" accept=".png,.jpg,.jpeg" class="w-full">
    </div>

    <button type="button" onclick="saveData()" class="bg-blue-600 text-white px-4 py-2 rounded">L∆∞u th√¥ng tin</button>
  </form>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbyHAcUF5QhjuKxGz2wEFeNFqFRP3qJiIoybyArDLsvkr5bdx8LFA6gIHe-3TMTUbbyg/exec"; // thay b·∫±ng link Apps Script Web App
    const CLOUD_NAME = "dy3e7nrkv";
    const UPLOAD_PRESET = "employee_upload";

    function generateId() {
      return Math.floor(100000000 + Math.random() * 900000000).toString();
    }

    // Upload file l√™n Cloudinary
    async function uploadToCloudinary(file) {
      const formData = new FormData();
      formData.append("file", file);
      formData.append("upload_preset", UPLOAD_PRESET);

      const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
        method: "POST",
        body: formData
      });

      const json = await res.json();
      if (json.secure_url) {
        return json.secure_url;
      } else {
        throw new Error("Upload th·∫•t b·∫°i: " + JSON.stringify(json));
      }
    }

    // L∆∞u d·ªØ li·ªáu
    async function saveData() {
      const fileInput = document.getElementById("avatar");
      let avatarUrl = "";

      if (fileInput.files.length > 0) {
        try {
          console.log("‚è≥ Upload Cloudinary...");
          avatarUrl = await uploadToCloudinary(fileInput.files[0]);
          console.log("‚úÖ Upload th√†nh c√¥ng:", avatarUrl);
        } catch (err) {
          alert("‚ùå L·ªói upload Cloudinary: " + err.message);
          return;
        }
      }

      const data = {
        id: document.getElementById("id").value || generateId(),
        name: document.getElementById("name").value,
        dob: document.getElementById("dob").value,
        phone: document.getElementById("phone").value,
        start: document.getElementById("start").value,
        position: document.getElementById("position").value,
        department: document.getElementById("department").value,
        avatar: avatarUrl
      };

      console.log("üì§ Data g·ª≠i:", data);

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(data)
        });
        const text = await res.text();
        console.log("üì• Server tr·∫£ v·ªÅ:", text);
        alert("Server response: " + text);
      } catch (err) {
        alert("‚ùå L·ªói khi l∆∞u: " + err);
      }
    }

    // G√°n ID ng·∫´u nhi√™n khi load form
    document.getElementById("id").value = generateId();
  </script>
</body>
</html>
